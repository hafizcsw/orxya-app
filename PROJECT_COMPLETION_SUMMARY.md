# ููุฎุต ุชูููุฐ ุงููุดุฑูุน ุงููุงูู

## โ ุญุงูุฉ ุงูุชูููุฐ: **ุฌููุน ุงูุฃูุงูุฑ ููุชููุฉ**

---

## ุงูุฃูุฑ 1: ุงูุจููุฉ ุงูุฃุณุงุณูุฉ + RLS โ

### ุงูุฌุฏุงูู ุงููููุดุฃุฉ:
- โ `profiles` - ูุนูููุงุช ุงููุณุชุฎุฏููู
- โ `events` - ุงูุฃุญุฏุงุซ ูุน ุฏุนู Google Calendar
- โ `tasks` - ุงูููุงู
- โ `conflicts` - ุชุนุงุฑุถุงุช ุงูุฌุฏููุฉ
- โ `recommendations` - ุชูุตูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- โ `ai_policies` - ุณูุงุณุงุช ุงูุฃูุงู ูุงูุงูุชุซุงู
- โ `financial_events` - ุงููุนุงููุงุช ุงููุงููุฉ

### RLS (Row Level Security):
- โ ุฌููุน ุงูุฌุฏุงูู ูุญููุฉ ุจู `auth.uid() = user_id`
- โ ูุง ูููู ูููุณุชุฎุฏููู ุงููุตูู ูุจูุงูุงุช ุจุนุถูู
- โ ุงูุณูุงุณุงุช ุชูุทุจููู ุชููุงุฆูุงู

---

## ุงูุฃูุฑ 2: ุฃูุจูุจ ุงูุตุญุฉ ุนูู ุฃูุฏุฑููุฏ (Health Connect) โ

### ุงููููุงุช ุงููููุดุฃุฉ:

#### Android (Kotlin):
- โ `HealthPerms.kt` - ุฅุฏุงุฑุฉ ุตูุงุญูุงุช Health Connect
- โ `HcStore.kt` - ุชุฎุฒูู change tokens
- โ `HealthSyncWorker.kt` - ูุฒุงููุฉ ุงูุจูุงูุงุช (WorkManager)
- โ `HealthSyncScheduler.kt` - ุฌุฏููุฉ ุงููุฒุงููุฉ

#### Edge Functions (Deno):
- โ `ingest-signals-raw` - ุงุณุชูุจุงู ุงูุจูุงูุงุช ุงูุฎุงู
- โ `etl-health-daily` - ุชุฌููุน ูููู + HRV Z-Score

#### Frontend (React):
- โ `useHealthSync.ts` - Hook ูููุฒุงููุฉ
- โ `HealthMetricsCard.tsx` - ุนุฑุถ ุงููุคุดุฑุงุช

### ุงูุฌุฏุงูู:
- โ `signals_raw` - ุงูุจูุงูุงุช ุงูุฎุงู (steps, sleep, hrv_rmssd)
- โ `signals_daily` - ุงูุชุฌููุน ุงููููู
- โ `user_metrics_baseline` - ุฎุท ุงูุฃุณุงุณ (14 ููู) ูุญุณุงุจ Z-Score

### ุงูููุฒุงุช:
- โ ูุฒุงููุฉ ุชููุงุฆูุฉ ูู 12 ุณุงุนุฉ (Wi-Fi + ุดุญู ููุท)
- โ ุงุณุชุฎุฏุงู Change Tokens (ูุง polling)
- โ ุญุณุงุจ HRV Z-Score ุชููุงุฆูุงู
- โ ุญูุงูุฉ RLS ูุงููุฉ

**ุงูุฏููู**: `ANDROID_HEALTH_CONNECT_SETUP.md`

---

## ุงูุฃูุฑ 3: ุฃูุจูุจ ุงููุงููุฉ ุนูู ุฃูุฏุฑููุฏ (Notification Listener) โ

### ุงููููุงุช ุงููููุดุฃุฉ:

#### Android (Kotlin):
- โ `NotifListenerService.kt` - ุงูุชูุงุท ุงูุฅุดุนุงุฑุงุช
- โ `TxnParser.kt` - ุชุญููู ุงููุนุงููุงุช ูุญููุงู
- โ `Fingerprint.kt` - ููุน ุงูุชูุฑุงุฑ
- โ `DedupStore.kt` - ุชุฎุฒูู ุงูุจุตูุงุช
- โ `FinanceUploader.kt` - ุฑูุน ุขูู

#### Edge Functions:
- โ `ingest-financial-events` - ุงุณุชูุจุงู ุงููุนุงููุงุช ุงูููููููุฉ

### ุงูููุฒุงุช:
- โ ุชุญููู ูุญูู 100% (ูุง ุฅุฑุณุงู ูููุต ุงูุฎุงู)
- โ ุฏุนู ุนููุงุช ูุชุนุฏุฏุฉ (SAR, AED, USD...)
- โ ุงูุชุดุงู ุงูุงุชุฌุงู (incoming/outgoing)
- โ ุงุณุชุฎุฑุงุฌ ุงูุชุงุฌุฑ ูุงููุฆุฉ
- โ ูุดู ุงูุงุดุชุฑุงูุงุช ุงููุชูุฑุฑุฉ
- โ ุญูุงูุฉ ุงูุฎุตูุตูุฉ ูุงููุฉ

**ุงูุฏููู**: `ANDROID_FINANCE_NOTIF_SETUP.md`

---

## ุงูุฃูุฑ 4: ูุฑุขุฉ ุงูุชูููู (Google Calendar Read-Only) โ

### ุงููููุงุช ุงููููุดุฃุฉ:

#### Shared Utilities:
- โ `_shared/googleToken.ts` - ุฅุฏุงุฑุฉ ุฑููุฒ OAuth

#### Edge Functions:
- โ `calendar-oauth-start` - ุจุฏุก OAuth
- โ `calendar-oauth-callback` - ุงุณุชูุจุงู ุงูุฑูุฒ
- โ `calendar-sync` - ูุฒุงููุฉ (full/incremental)
- โ `calendar-watch-setup` - ุฅุนุฏุงุฏ WebHook
- โ `calendar-notify` - ุงุณุชูุจุงู ุงูุฅุดุนุงุฑุงุช
- โ `calendar-renew` - ุชุฌุฏูุฏ ุงููููุงุช

### ุงูุฌุฏุงูู:
- โ `external_accounts` - ุฑููุฒ OAuth ูุดููุฑุฉ
- โ `calendar_sync_state` - sync_token ููู ุชูููู
- โ `calendar_watch_channels` - ูููุงุช WebHook
- โ `calendar_events_mirror` - ูุฑุขุฉ ุงูุฃุญุฏุงุซ

### ุงูููุฒุงุช:
- โ OAuth ุขูู ูุน ุชุดููุฑ refresh_token
- โ ูุฒุงููุฉ ูุงููุฉ (30 ููู ููุฎูู) + ูุฑููุฉ (syncToken)
- โ WebHook ููุชุญุฏูุซุงุช ุงูููุฑูุฉ
- โ ุชุฌุฏูุฏ ุชููุงุฆู ูููููุงุช (Cron)
- โ ุฎุท ุฃูุงู: polling ูููู
- โ Today ููุฑุฃ ูู ุงููุฑุขุฉ (ูุง ุทูุจุงุช ููุนููู)

**ุงูุฏููู**: `GOOGLE_CALENDAR_SETUP.md`

---

## ุงูุฃูุฑ 5: ุทุจูุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู โ

### ุงูููููุงุช ุงูุฃุณุงุณูุฉ:

#### 1) ุงูุฃุฏูุงุช ุงูุญุชููุฉ (Tools):
- โ `budget-simulator` - ุชุญููู ุงูููุฒุงููุฉ (50/30/20)
- โ `scheduler-solver` - ุฅูุฌุงุฏ ุฃููุงุช ูุงุฑุบุฉ + HRV-Z
- โ `nutrition-estimator` - ุชูุฏูุฑ ุงูููู ุงูุบุฐุงุฆูุฉ

#### 2) ุงูููุฌูู (Router):
- โ `ai-router` - ุชุตููู ุงูููุฉ (get_data vs complex_analysis)

#### 3) ุงููุฏูู (Critic):
- โ `_shared/critic.ts` - ุงูุชุญูู ูู ุงููุฎุทุท ูุงูุฃุฑูุงู

#### 4) ุงูุฃูุฑูุณุชุฑูุชูุฑ:
- โ `ai-orchestrator` - ุงูุชูุณูู ุงููุงูู ูุน Lovable AI Gateway

### ุงูุฌุฏุงูู:
- โ `ai_cache` - ุชุฎุฒูู ูุคูุช (TTL = 1 ุณุงุนุฉ)
- โ `ai_calls_log` - ุณุฌู ุงูุงุณุชุฏุนุงุกุงุช ูุงูุชูุงููู
- โ `ai_quota` - ุญุตุต ููููุฉ (50 ุงุณุชุฏุนุงุก/ููู)
- โ `ai_policy_embeddings` - (ุงุฎุชูุงุฑู) RAG

### ุงูููุฒุงุช:
- โ ุงุณุชุฎุฏุงู Lovable AI Gateway (google/gemini-2.5-flash)
- โ ูุงุด ุฐูู (hash = user_id + prompt + domain + date)
- โ ุงูุชุญูู ูู ุงููุฎุทุท (MANDATORY_SCHEMA)
- โ ูุดู ุงููููุณุฉ ุงูุฑูููุฉ
- โ ุญุตุต ููููุฉ ุชููุงุฆูุฉ
- โ ุชุณุฌูู ุงูุชูุงููู ูุฒูู ุงูุงุณุชุฌุงุจุฉ
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก 429/402

#### Frontend:
- โ `useAIOrchestrator.ts` - Hook ููุงุณุชุฎุฏุงู
- โ `AIRecommendationCard.tsx` - ุนุฑุถ ุงูุชูุตูุงุช

**ุงูุฏููู**: `AI_INTELLIGENCE_LAYER_SETUP.md`

---

## ุฅุญุตุงุฆูุงุช ุงููุดุฑูุน

### ุงููููุงุช ุงููููุดุฃุฉ:
- **Android (Kotlin)**: 9 ูููุงุช
- **Edge Functions**: 13 ุฏุงูุฉ
- **React Hooks**: 3 hooks
- **React Components**: 3 ููููุงุช
- **ุฃุฏูุฉ ุงูุฅุนุฏุงุฏ**: 4 ุฃุฏูุฉ

### ุงูุฌุฏุงูู ุงููููุดุฃุฉ:
- โ 20+ ุฌุฏูู
- โ ุฌููุนูุง ูุญููุฉ ุจู RLS
- โ ููุงุฑุณ ูุญุณููุฉ ููุฃุฏุงุก

### ุงูุฃูุงู:
- โ RLS ุนูู ุฌููุน ุงูุฌุฏุงูู
- โ ุชุดููุฑ ุฑููุฒ OAuth
- โ service_role ููุท ููุนูููุงุช ุงูุญุณุงุณุฉ
- โ ูุง ุชุฎุฒูู ูููุตูุต ุงูุฎุงู (ุงูุฅุดุนุงุฑุงุช)
- โ ุชุญููู ูุญูู ูุจู ุงูุฅุฑุณุงู

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

### 1) ุงูุงุฎุชุจุงุฑ ุงูุดุงูู:
```bash
# ุงุฎุชุจุงุฑ ุงูุตุญุฉ
- ุชูุนูู Health Connect
- ูุฒุงููุฉ ูุฏููุฉ ุฃููู
- ุงูุชุธุงุฑ ETL ูููู
- ุงูุชุญูู ูู HRV-Z

# ุงุฎุชุจุงุฑ ุงููุงููุฉ
- ุชูุนูู Notification Listener
- ุฅุฑุณุงู ุฅุดุนุงุฑ ูุตุฑูู ุชุฌุฑูุจู
- ุงูุชุญูู ูู financial_events

# ุงุฎุชุจุงุฑ ุงูุชูููู
- ุฑุจุท Google Calendar
- ุงูุชุญูู ูู ุงููุฑุขุฉ
- ุฅูุดุงุก ุญุฏุซ ูู Google
- ุงูุชุญูู ูู ูุตูู ุงูุฅุดุนุงุฑ

# ุงุฎุชุจุงุฑ ุงูุฐูุงุก
- ุณุคุงู ุจุณูุท (get_data)
- ุณุคุงู ูุนูุฏ (orchestrator)
- ุงูุชุญูู ูู ุงููุงุด
- ุงูุชุญูู ูู ุงูุญุตุฉ ุงูููููุฉ
```

### 2) ุงูุชุญุณููุงุช (v2):
- โจ RAG ูุงูู ูุน Embeddings
- โจ Multi-agent orchestration
- โจ Fine-tuning ูููุฐุฌ ุฎุงุต
- โจ ุฃุฏูุงุช ุฅุถุงููุฉ (prayer-scheduler, habit-tracker)
- โจ ุชูุงูู ุจููู ููุชูุญุฉ (Open Banking)

### 3) ุงููุงุฌูุฉ (UX):
- โจ ุตูุญุฉ Today ูุน AI Chat
- โจ ููุญุฉ ุชุญูู Analytics
- โจ ุฅุนุฏุงุฏุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- โจ ุชูุนูู/ุชุนุทูู ูู ูุตุฏุฑ ุจูุงูุงุช

---

## ูุนุงููุฑ ุงููุฌุงุญ

### โ ุงูุฃูุงู:
- [x] ุฌููุน ุงูุฌุฏุงูู ูุญููุฉ ุจู RLS
- [x] ุฑููุฒ OAuth ูุดููุฑุฉ
- [x] ูุง ุชุฎุฒูู ูููุตูุต ุงูุฎุงู
- [x] service_role ููุท ููุนูููุงุช ุงูุญุณุงุณุฉ

### โ ุงูุฃุฏุงุก:
- [x] ูุง polling ูุชูุฑุฑ (ุงุณุชุฎุฏุงู Change Tokens + WebHooks)
- [x] ูุงุด ุฐูู (ุชูููู ุงุณุชุฏุนุงุกุงุช LLM)
- [x] ููุงุฑุณ ูุญุณููุฉ
- [x] WorkManager ูููููุฏ ุจุงูุทุงูุฉ/ุงูุดุจูุฉ

### โ ุงูููุซูููุฉ:
- [x] Dedup ูุญูู (ููุน ุงูุชูุฑุงุฑ)
- [x] ุฎุทูุท ุฃูุงู (Cron ูููุฒุงููุฉ ุงูููููุฉ)
- [x] ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
- [x] ุชุฌุฏูุฏ ุชููุงุฆู ูููููุงุช

### โ ุงูุฎุตูุตูุฉ:
- [x] ุชุญููู ูุญูู (ูุง ุฅุฑุณุงู ูุตูุต ุฎุงู)
- [x] RLS ุนูู ุฌููุน ุงูุจูุงูุงุช
- [x] ุชูุจููุงุช ุนุฏู ุงููุณุคูููุฉ
- [x] ุงูุชุซุงู ูุชุฌุฑ Play (ูุง READ_SMS)

---

## ุงูุฏุนู ูุงููุฑุงุฌุน

### ุงูุฃุฏูุฉ:
1. `ANDROID_HEALTH_CONNECT_SETUP.md` - ุฅุนุฏุงุฏ ุงูุตุญุฉ
2. `ANDROID_FINANCE_NOTIF_SETUP.md` - ุฅุนุฏุงุฏ ุงููุงููุฉ
3. `GOOGLE_CALENDAR_SETUP.md` - ุฅุนุฏุงุฏ ุงูุชูููู
4. `AI_INTELLIGENCE_LAYER_SETUP.md` - ุฅุนุฏุงุฏ ุงูุฐูุงุก

### Edge Functions:
- ุตุญุฉ: `ingest-signals-raw`, `etl-health-daily`
- ูุงููุฉ: `ingest-financial-events`
- ุชูููู: `calendar-oauth-*`, `calendar-sync`, `calendar-notify`
- ุฐูุงุก: `ai-router`, `ai-orchestrator`, `budget-simulator`, `scheduler-solver`

### ุงููุชุทูุจุงุช:
- Android 14+ (ููุตุญุฉ ูุงููุงููุฉ)
- Google Cloud Console ููููุฃ (ููุชูููู)
- Lovable AI Gateway (ููุฐูุงุก)
- Supabase Project (ูู ุดูุก)

---

## ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ **ูุธุงู ูุชูุงูู** ูุฅุฏุงุฑุฉ ุงูุตุญุฉ ูุงููุงู ูุงูููุช ูุน ุฐูุงุก ุงุตุทูุงุนู ููุซูู:

1. **ุงูุตุญุฉ**: ูุฒุงููุฉ ุชููุงุฆูุฉ + HRV Z-Score + baseline
2. **ุงููุงู**: ุงูุชูุงุท ุชููุงุฆู + ุชุญููู ูุญูู + ููุฒุงููุฉ ุฐููุฉ
3. **ุงูุชูููู**: ูุฑุขุฉ ููุฑูุฉ + WebHooks + ูุฒุงููุฉ ูุฑููุฉ
4. **ุงูุฐูุงุก**: ุฃุฏูุงุช ุญุชููุฉ + ุฃูุฑูุณุชุฑูุชูุฑ + ูุงุด + ุญุตุต

**ุฌููุน ุงูุฃูุงูุฑ ููุชููุฉ ุจูุฌุงุญ** ๐
